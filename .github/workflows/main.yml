# This is a basic workflow to help you get started with Actions

name: Windows Osiris Compile

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the master branch
on:
  push:
    branches: [ master, health_based_bars]
  pull_request:
    branches: [ master, health_based_bars]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: windows-latest

    env: # Thanks to @robootgit
      MSBUILD_PATH: C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\MSBuild\Current\Bin\

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
    - uses: actions/checkout@v2

    
    - name: Cache for AVX
      uses: actions/cache@v1
      with:
        path: Osiris\Release
        key: avx_cache

    - name: Build for AVX
      shell: cmd
      run: '"%MSBUILD_PATH%\MSBuild.exe" -m Osiris.sln  /t:build /p:Platform=x86;Configuration=Release;TargetName=Osiris_-_AVX;EIS=AdvancedVectorExtensions'

    - name: Cache for AVX2
      uses: actions/cache@v1
      with:
        path: Osiris\Release
        key: avx2_cache

    - name: Build for AVX2
      shell: cmd
      run: '"%MSBUILD_PATH%\MSBuild.exe" -m Osiris.sln  /t:build /p:Platform=x86;Configuration=Release;TargetName=Osiris_-_AVX2;EIS=AdvancedVectorExtensions2'
    
    - name: Cache for SSE
      uses: actions/cache@v1
      with:
        path: Osiris\Release
        key: sse_cache
    
    - name: Build for SSE
      shell: cmd
      run: '"%MSBUILD_PATH%\MSBuild.exe" -m Osiris.sln  /t:build /p:Platform=x86;Configuration=Release;TargetName=Osiris_-_SSE;EIS=StreamingSIMDExtensions'

    - name: Cache for IA32
      uses: actions/cache@v1
      with:
        path: Osiris\Release
        key: ia32_cache

    - name: Build for IA32
      shell: cmd
      run: '"%MSBUILD_PATH%\MSBuild.exe" -m Osiris.sln  /t:build /p:Platform=x86;Configuration=Release;TargetName=Osiris_-_IA32;EIS=NoExtensions'
      
    - uses: actions/upload-artifact@v1
      with:
        name: Osiris Build Output
        path: Release

